#!/usr/bin/env python2
#HEAD#########################################################
#
# Katana Framework | ktf.console                            
# Last Modified: 23/12/2016
#
#########################################################HEAD#

from core.MainListLibrary import *
from core.GeneralCommands import *
from core import Banner , Errors 
from core.Design import *

def katanaFrameworkConsole():
	try:
		action = raw_input(MainPrompt())
		if KatanaCheckActionShowModules(action):
			ListModules()
			katanaFrameworkConsole()
		if KatanaCheckActionUseModule(action):
			root=GetRootModules()
			for modules in root.findall('module'):
				if action[len(SELECT)+1:] == modules.get('name'):
					ModuleToStart = importlib.import_module("modules."+modules.find('category').text+"."+modules.find('filename').text) 
					init=ModuleToStart.init()
					real_init = init.options.copy()
					init=LoadSession(init)
					while True:
						try:
							actions=raw_input(Prompt(init.CodeName))
							if   KatanaCheckActionShowOptions(actions)  :ShowOptions(init)
							elif KatanaCheckActionShowMOptions(actions) :ShowFullOptions(init)
							elif KatanaCheckActionExefunction(actions)  :Executefunction(actions)
							elif KatanaCheckActionInvoke(actions)       :Invoke(actions)
							elif KatanaCheckSession(actions)            :init=SessionInterative(actions,init)
							elif KatanaCheckActionSetValue(actions)     :init=UpdateValue(actions,init,real_init)
							elif KatanaCheckActionGetInfo(actions)      :ShowInformationModule(init)
							elif runModule(actions):
								for Namevalue in init.options:
									init.var.update({Namevalue:init.options[Namevalue][0]})
								try:
									for Namevalue in init.extra:
										init.var.update({Namevalue:init.extra[Namevalue][0]})
								except:Nothing=False
								SaveSession(init)
								ModuleToStart.main(True)
							elif KatanaCheckActionisBack(actions)       :katanaFrameworkConsole()
							else:KatanaCheckActionGlobalCommands(actions)
						except:Errors.Errors()
			katanaFrameworkConsole()
		elif KatanaCheckActionExefunction(action)                       :Executefunction(action)
		else                                                            :KatanaCheckActionGlobalCommands(action)
		katanaFrameworkConsole()
	except                                                              :Errors.Errors()
	  
if __name__=="__main__":
	
	LoadBuffer()
	LoadGlobalVariables()
	Banner.LoadBanner()
	katanaFrameworkConsole()
